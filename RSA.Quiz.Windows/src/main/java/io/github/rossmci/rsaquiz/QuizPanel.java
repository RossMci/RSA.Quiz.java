package io.github.rossmci.rsaquiz;

import java.util.ResourceBundle;
import javax.swing.JButton;

public class QuizPanel extends RsaQuizPanel
{

	public QuizPanel()
	{
		initComponents();
		buttons = new JButton[]
		{
			option1jButton,
			pic2jButton,
			pic3jButton
//			option1ToggleButton,
//			pic2ToggleButton,
//			pic3Button
		};
	}

	@Override
	public void reloadLocaleResource()
	{
		this.framesResourceBundle = ResourceBundle.getBundle("bundles/Frames", this.getRsaQuizManger().getLocale());
		backjButton.setText(framesResourceBundle.getString("QuizFrame.optionsToggleButton.text")); // NOI18N
		nextjButton.setText(framesResourceBundle.getString("QuizFrame.startToggleButton.text")); // NOI18N
		InstructionLabel.setText(framesResourceBundle.getString("QuizFrame.instructionLabel.text")); // NOI18N

		//TODO:this.TimeLabel.setText(date.tosTring(rsaQuiz.getLocale()));
//	      DateFormat formatter = DateFormat.getDateTimeInstance(DateFormat.SHORT, DateFormat.SHORT, rsaQuiz.getLocale());
//		  TimeLabel.setText(formatter.format(cal.getTime()));
	}

	/**
	 * This method is called from within the constructor to initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is always
	 * regenerated by the Form Editor.
	 */
	@SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents()
    {

        mainPanel = new javax.swing.JPanel();
        imagelabel = new javax.swing.JLabel();
        TimeLabel = new javax.swing.JLabel();
        PictureQuestionPanel = new javax.swing.JPanel();
        InstructionLabel = new javax.swing.JLabel();
        pic3jButton = new javax.swing.JButton();
        pic2jButton = new javax.swing.JButton();
        option1jButton = new javax.swing.JButton();
        QuestionLabel = new javax.swing.JLabel();
        SymbolLabel = new javax.swing.JLabel();
        MaxLabel = new javax.swing.JLabel();
        counterLabel = new javax.swing.JLabel();
        SubmitAnswerjButton = new javax.swing.JButton();
        nextjButton = new javax.swing.JButton();
        backjButton = new javax.swing.JButton();

        setPreferredSize(new java.awt.Dimension(687, 590));

        mainPanel.setBackground(new java.awt.Color(255, 51, 51));
        mainPanel.setPreferredSize(new java.awt.Dimension(687, 542));

        imagelabel.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        imagelabel.setIcon(new javax.swing.ImageIcon(getClass().getResource("/images/rsa-logo.png"))); // NOI18N

        TimeLabel.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        TimeLabel.setForeground(new java.awt.Color(255, 255, 255));
        TimeLabel.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        TimeLabel.setText("17:00"); // NOI18N

        PictureQuestionPanel.setBackground(new java.awt.Color(255, 255, 255));
        PictureQuestionPanel.setBorder(javax.swing.BorderFactory.createMatteBorder(1, 0, 1, 0, new java.awt.Color(255, 51, 51)));

        InstructionLabel.setFont(new java.awt.Font("Tahoma", 0, 18)); // NOI18N
        InstructionLabel.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        InstructionLabel.setText(framesResourceBundle.getString("QuizFrame.instructionLabel.text")); // NOI18N

        pic3jButton.setBackground(new java.awt.Color(255, 255, 255));
        pic3jButton.setIcon(new javax.swing.ImageIcon(getClass().getResource("/signs/info_signs/Airport.gif"))); // NOI18N
        pic3jButton.setBorder(null);
        pic3jButton.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                pic3jButtonActionPerformed(evt);
            }
        });

        pic2jButton.setBackground(new java.awt.Color(255, 255, 255));
        pic2jButton.setFont(new java.awt.Font("Tahoma", 0, 18)); // NOI18N
        pic2jButton.setIcon(new javax.swing.ImageIcon(getClass().getResource("/signs/tourist_signs/Sign to approved tourist information point.gif"))); // NOI18N
        pic2jButton.setBorder(null);
        pic2jButton.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                pic2jButtonActionPerformed(evt);
            }
        });

        option1jButton.setBackground(new java.awt.Color(255, 255, 255));
        option1jButton.setIcon(new javax.swing.ImageIcon(getClass().getResource("/signs/tourist_signs/Pedestrian sign to a car park.gif"))); // NOI18N
        option1jButton.setBorder(null);
        option1jButton.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                option1jButtonActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout PictureQuestionPanelLayout = new javax.swing.GroupLayout(PictureQuestionPanel);
        PictureQuestionPanel.setLayout(PictureQuestionPanelLayout);
        PictureQuestionPanelLayout.setHorizontalGroup(
            PictureQuestionPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(InstructionLabel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addGroup(PictureQuestionPanelLayout.createSequentialGroup()
                .addComponent(option1jButton, javax.swing.GroupLayout.PREFERRED_SIZE, 181, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(pic2jButton, javax.swing.GroupLayout.PREFERRED_SIZE, 190, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(pic3jButton, javax.swing.GroupLayout.PREFERRED_SIZE, 148, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 34, Short.MAX_VALUE))
        );

        PictureQuestionPanelLayout.linkSize(javax.swing.SwingConstants.HORIZONTAL, new java.awt.Component[] {option1jButton, pic2jButton, pic3jButton});

        PictureQuestionPanelLayout.setVerticalGroup(
            PictureQuestionPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(PictureQuestionPanelLayout.createSequentialGroup()
                .addGap(8, 8, 8)
                .addComponent(InstructionLabel)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(PictureQuestionPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(pic2jButton, javax.swing.GroupLayout.PREFERRED_SIZE, 353, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(option1jButton, javax.swing.GroupLayout.PREFERRED_SIZE, 353, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(pic3jButton, javax.swing.GroupLayout.PREFERRED_SIZE, 353, javax.swing.GroupLayout.PREFERRED_SIZE)))
        );

        PictureQuestionPanelLayout.linkSize(javax.swing.SwingConstants.VERTICAL, new java.awt.Component[] {option1jButton, pic2jButton, pic3jButton});

        QuestionLabel.setBackground(new java.awt.Color(255, 51, 51));
        QuestionLabel.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        QuestionLabel.setForeground(new java.awt.Color(255, 255, 255));
        QuestionLabel.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        QuestionLabel.setText("Test Question");

        SymbolLabel.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        SymbolLabel.setForeground(new java.awt.Color(255, 255, 255));
        SymbolLabel.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        SymbolLabel.setText("/"); // NOI18N

        MaxLabel.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        MaxLabel.setForeground(new java.awt.Color(255, 255, 255));
        MaxLabel.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        MaxLabel.setText("20"); // NOI18N

        counterLabel.setFont(new java.awt.Font("Tahoma", 1, 18)); // NOI18N
        counterLabel.setForeground(new java.awt.Color(255, 255, 255));
        counterLabel.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        counterLabel.setText("1"); // NOI18N

        SubmitAnswerjButton.setBackground(new java.awt.Color(0, 0, 0));
        SubmitAnswerjButton.setForeground(new java.awt.Color(255, 255, 255));
        SubmitAnswerjButton.setText("Submit Test");
        SubmitAnswerjButton.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                SubmitAnswerjButtonActionPerformed(evt);
            }
        });

        nextjButton.setBackground(new java.awt.Color(0, 0, 0));
        nextjButton.setForeground(new java.awt.Color(255, 255, 255));
        nextjButton.setText("Next");
        nextjButton.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                nextjButtonActionPerformed(evt);
            }
        });

        backjButton.setBackground(new java.awt.Color(0, 0, 0));
        backjButton.setForeground(new java.awt.Color(255, 255, 255));
        backjButton.setText("Back");
        backjButton.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                backjButtonActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout mainPanelLayout = new javax.swing.GroupLayout(mainPanel);
        mainPanel.setLayout(mainPanelLayout);
        mainPanelLayout.setHorizontalGroup(
            mainPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(mainPanelLayout.createSequentialGroup()
                .addGap(14, 14, 14)
                .addComponent(TimeLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 135, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(imagelabel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
            .addComponent(PictureQuestionPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, mainPanelLayout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(backjButton)
                .addGap(65, 65, 65)
                .addComponent(counterLabel)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(SymbolLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 26, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(MaxLabel)
                .addGap(62, 62, 62)
                .addComponent(nextjButton)
                .addGap(50, 50, 50)
                .addComponent(SubmitAnswerjButton)
                .addGap(27, 27, 27))
            .addComponent(QuestionLabel, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        mainPanelLayout.setVerticalGroup(
            mainPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(mainPanelLayout.createSequentialGroup()
                .addGroup(mainPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(imagelabel, javax.swing.GroupLayout.PREFERRED_SIZE, 48, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(mainPanelLayout.createSequentialGroup()
                        .addGap(18, 18, 18)
                        .addComponent(TimeLabel)))
                .addGap(18, 18, 18)
                .addComponent(PictureQuestionPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(QuestionLabel, javax.swing.GroupLayout.PREFERRED_SIZE, 37, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(mainPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(mainPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(SubmitAnswerjButton)
                        .addComponent(nextjButton)
                        .addComponent(counterLabel)
                        .addComponent(SymbolLabel)
                        .addComponent(MaxLabel))
                    .addComponent(backjButton))
                .addGap(11, 11, 11))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(mainPanel, javax.swing.GroupLayout.PREFERRED_SIZE, 616, javax.swing.GroupLayout.PREFERRED_SIZE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(mainPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, Short.MAX_VALUE))
        );
    }// </editor-fold>//GEN-END:initComponents

	int currentIndex = 0;
    private void pic2jButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_pic2jButtonActionPerformed
    {//GEN-HEADEREND:event_pic2jButtonActionPerformed
		checkAnswer(1);
    }//GEN-LAST:event_pic2jButtonActionPerformed

    private void pic3jButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_pic3jButtonActionPerformed
    {//GEN-HEADEREND:event_pic3jButtonActionPerformed
		checkAnswer(2);
    }//GEN-LAST:event_pic3jButtonActionPerformed

    private void option1jButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_option1jButtonActionPerformed
    {//GEN-HEADEREND:event_option1jButtonActionPerformed
		checkAnswer(0);
    }//GEN-LAST:event_option1jButtonActionPerformed

    private void SubmitAnswerjButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_SubmitAnswerjButtonActionPerformed
    {//GEN-HEADEREND:event_SubmitAnswerjButtonActionPerformed
		this.getRsaQuizManger().setFeedBackVisible(true);

    }//GEN-LAST:event_SubmitAnswerjButtonActionPerformed

    private void backjButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_backjButtonActionPerformed
    {//GEN-HEADEREND:event_backjButtonActionPerformed
		loadPreviousQuestion();
    }//GEN-LAST:event_backjButtonActionPerformed

    private void nextjButtonActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_nextjButtonActionPerformed
    {//GEN-HEADEREND:event_nextjButtonActionPerformed
		loadNextQuestion();
    }//GEN-LAST:event_nextjButtonActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    public static javax.swing.JLabel InstructionLabel;
    private javax.swing.JLabel MaxLabel;
    private javax.swing.JPanel PictureQuestionPanel;
    private javax.swing.JLabel QuestionLabel;
    private javax.swing.JButton SubmitAnswerjButton;
    private javax.swing.JLabel SymbolLabel;
    private javax.swing.JLabel TimeLabel;
    private javax.swing.JButton backjButton;
    private javax.swing.JLabel counterLabel;
    private javax.swing.JLabel imagelabel;
    private javax.swing.JPanel mainPanel;
    private javax.swing.JButton nextjButton;
    private javax.swing.JButton option1jButton;
    private javax.swing.JButton pic2jButton;
    private javax.swing.JButton pic3jButton;
    // End of variables declaration//GEN-END:variables

	private void loadQuestion(RsaSignQuestion question)
	{
		this.QuestionLabel.setText(question.getImageName());

		for (int index = 0; index < 3; index++)
		{
			buttons[index].setIcon(new javax.swing.ImageIcon(question.getOptions().get(index)));
		}
	}
	int correctIndex;
	final JButton[] buttons;

	private void checkAnswer(int selectedOptionIndex)
	{
		var question = this.getUserData().getQuizQuestions().get(currentIndex);
		boolean isAnswerCorrect = question.getOptions().get(selectedOptionIndex).equalsIgnoreCase(question.getImageName());
		getUserData().getUserQuizResults()[currentIndex] = isAnswerCorrect;

		loadNextQuestion();

	}

	public void loadPreviousQuestion()
	{
		currentIndex--;
		this.nextjButton.setEnabled(true);
		if (currentIndex >= 0)
		{
			var question = this.getUserData().getQuizQuestions().get(currentIndex);
			this.counterLabel.setText("" + (currentIndex + 1));
			loadQuestion(question);
		}
		else
		{
			this.backjButton.setEnabled(false);
		}
	}

	public void initQuiz()
	{
		var question = this.getRsaQuizManger().getUser().getUserData().getQuizQuestions().get(currentIndex);
		loadQuestion(question);
	}

	public void loadNextQuestion()
	{
		this.backjButton.setEnabled(true);
		currentIndex++;
		if (currentIndex < this.getRsaQuizManger().getUser().getUserData().getQuizQuestions().size())
		{
			var question = this.getUserData().getQuizQuestions().get(currentIndex);
			loadQuestion(question);
			//highlight if Answed
			this.counterLabel.setText("" + (currentIndex + 1));
		}
		else
		{
			this.nextjButton.setEnabled(false);
		}
	}
}
